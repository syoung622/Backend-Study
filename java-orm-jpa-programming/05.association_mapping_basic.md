### 연관관계 매핑 기초

#### 단방향 연관관계

- 객체의 참조와 테이블의 외래키를 매핑

![association](https://user-images.githubusercontent.com/68267278/164116633-7d4a0183-a9ad-4254-97fc-49c60ce1b596.png)

- 객체 연관관계
    - 참조를 통한 연관관계
    - 항상 단방향
    - 양방향으로 참조하려면 서로 다른 단방향 관계 2개 생성 필요
- 테이블 연관관계
    - 외래키를 통한 연관관계
    - 조인(JOIN) 사용

##### 연관관계 매핑 어노테이션

객체 연관관계 설정을 위해 아래와 같은 어노테이션 필요

- 다중성 어노테이션(필수)
    - `@ManyToOne`
    - `@OneToMany`
    - `@OneToOne`
- 외래키 매핑
    - `@JoinColumn(name = 매핑할 외래키 이름)`

#### 연관관계 사용

- 연관관계 엔티티 저장
    - 연관된 모든 엔티티는 영속 상태
- 연관관계 엔티티 조회
    - 갹체 연관관계를 통해서 조회 
    ``` java
    Member member = em.find(Member.class, "member1");
    Team team = member.getTeam();
    ```
- 연관관계 수정
    - 참조하는 대상만 변경
    - 커밋시에 플러시 발생하면서 변경 사항 DB에 자동 반영
    ``` java
    // 새로운 팀2
    Team team2 = new Team("team2", "팀2");
    em.persist(team2);

    // 회원1에 새로운 팀2 설정
    Member member = em.find(Member.class, "member1");
    member.setTeam(team2);
    ```
- 연관관계 삭제
    - 연관관게 null 설정하여 연관관계 제거 후 엔티티 삭제
    ``` java
    member1.setTeam(null); //회원1 연관관계 삭제
    member2.setTeam(null); //회원2 연관관계 삭제
    em.remove(team); //팀 삭제
    ```

#### 양방향 연관관계

- 양방향 연관관계에서 엔티티를 `@ManyToOne`으로 매핑했다면 다른 엔티티는 `@OneToMany(mappedBy = "반대쪽 매핑의 필드 이름")`으로 매핑
- 연관관계 2개 존재, 외래키는 하나 존재
    - 외래키를 관리할 연관관계의 주인 설정 필요

#### 양방향 주인

- 양방향 매핑 규칙
    - 연관관계의 주인만 DB 연관관계와 매핑, 외래키 관리
    - 주인 아닌 쪽은 읽기만 가능
    - 주인이 아니면 mappedBy 속성으로 연관관계 주인 지정
    - 연관관계의 주인은 외래키가 존재하는 곳

#### 양방향 연관간계 주의점

- 주인이 아닌 곳에 입력한 값은 외래키에 영향 x
- 객체 관점에서 양쪽 방향 모두 값 입력 필요
- 연관관계 편의 메소드를 생성하여 한번에 양방향 관계 설정
    - 연관관계 수정시, 기존의 연관관계 삭제 필요
- 양방향 매핑시, 무한 루프 주의
