### 스프링 핵심원리 프로젝트 예제

스프링 핵심 원리 이해를 위해 스프링 없는 순수한 자바로만 개발을 진행함.

- JDK: Java 11
- IDE: IntelliJ

#### 주문과 할인 전체 도메인

![orderdomain](https://user-images.githubusercontent.com/68267278/160562399-f180aa3f-2739-4083-8030-e4ac0350cc67.png)



![orderclassdiagram](https://user-images.githubusercontent.com/68267278/160534462-3145fff5-0fc2-45d6-93da-d43c92213bda.png)

- 회원 저장소 구현체가 변경되거나, 할인 정책이 변경되어도 주문 서비스를 변경할 필요 x
- 객체 간의 협력 관계는 유지됨.


#### 해당 도메인 설계의 문제점

``` java
public class OrderServiceImpl implements OrderService {

    //private final MemberRepository memberRepository = new MemoryMemberRepository();
    private final MemberRepository memberRepository = new DbMemberRepository();

    //private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();

}

```

- 회원 저장소와 할인정책 변경시, 클라이언트 코드에 영향 -> OCP 위반
- 회원 저장소와 할인정책 구현체 설정시, 인터페이스와 구현체 모두에 의존 -> DIP 위반

=> <b>인터페이스에만 의존하도록 설계 변경 필요</b>

###### 도메인 개발 코드
<details>
<summary>주문 도메인</summary>

``` java
public interface OrderService {

    //주문 생성 후 주문 결과 반환
    Order createOrder(Long memberId, String itemName, int itemPrice);
}

```

``` java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}

```
</details>

<details>
<summary>할인 도메인</summary>

``` java
public interface DiscountPolicy {

    //return 할인 대상 금액
    int discount(Member member, int price);
}
```

``` java
public class FixDiscountPolicy implements DiscountPolicy{

    private int discountFixAmount = 1000; //1000원 할인

    @Override
    public int discount(Member member, int price) {
        if(member.getGrade()== Grade.VIP){
            return discountFixAmount;
        }else {
            return 0;
        }
    }
}
```

``` java
public class RateDiscountPolicy implements DiscountPolicy{

    private int discountPercent = 10;

    @Override
    public int discount(Member member, int price) {
        if(member.getGrade()== Grade.VIP){
            return price * discountPercent/100;
        }
        else{
            return 0;
        }
    }
}
```
</details>

<details>
<summary>주문 Test</summary>

``` java
class OrderAppTest {

    MemberService memberService = new MemberServiceImpl();
    OrderService orderService = new OrderServiceImpl();

    @Test
    void createOrder() {
        Long memberId = 1L;
        Member member = new Member(memberId, "memberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 10000);
        Assertions.assertThat(order.getDiscountPrice()).isEqualTo(1000);
    }
}
```
</details>

<details>
<summary>할인정책 Test</summary>

``` java

class RateDiscountPolicyTest {

    RateDiscountPolicy discountPolicy = new RateDiscountPolicy();

    @Test
    @DisplayName("VIP는 10% 할인이 적용되어야 한다")
    void vip_o() {
        //given
        Member member = new Member(1L, "memberVIP", Grade.VIP);

        //when
        int discount = discountPolicy.discount(member, 10000);

        //then
        Assertions.assertThat(discount).isEqualTo(1000);
    }

    @Test
    @DisplayName("VIP가 아니면 할인이 적용되지 않아야 한다")
    void vip_x(){
        //given
        Member member = new Member(2L, "memberBASIC", Grade.BASIC);

        //when
        int discount = discountPolicy.discount(member, 10000);

        //then
        Assertions.assertThat(discount).isEqualTo(0);
    }
}
```
</details>

----

### AppConfig

- 어플리케이션 동작에 필요한 <b>구현 객체를 생성</b>
- 생성한 객체 인스턴스의 참조를 <b>생성자를 통해서 주입</b>

